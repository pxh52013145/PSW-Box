# AI 使用记录（Toolbox 课程设计）

本文记录在开发 ToolboxPassword（密码管理器）过程中使用 AI 助手的 Prompt、输出要点、采纳/否决原因与最终修改点，便于课程验收追溯。

## 1. 使用范围与原则
- 使用范围：需求拆解、接口设计、Qt/SQLite/多线程/网络模块用法查询、单元/集成测试用例设计、编译报错定位建议。
- 不使用范围：直接粘贴未知来源的大段外部项目代码；绕过课程要求或伪造过程记录。
- 采纳原则：AI 输出仅作建议，必须通过本地编译/运行/测试验证；涉及 API/行为细节以 Qt 官方文档与实际运行结果为准。

## 2. Prompt 与输出记录（节选）

### 2.1 密码管理器 Phase1：分组树 + 标签
- Prompt（节选）：按照计划文档，为密码管理器加入分组树（QTreeView + 自定义模型）与标签（多选）能力，并保持可编译运行。
- AI 输出要点：补齐 `groups/tags/entry_tags` 表；新增分组树模型；列表支持按分组/标签过滤；备份导入导出保持兼容。
- 采纳：采纳了“分组树 + 标签多对多 + 过滤代理模型”的方案，并把字段落到 SQLite。
- 最终修改：导入/导出与 UI 交互按现有工程结构调整，避免破坏原有 Vault/Repo 接口。

### 2.2 Phase2：密码生成器 + 强度评估 + 安全报告（多线程）
- Prompt（节选）：加入可配置密码生成器、强度可视化、安全报告（后台扫描弱/重复/过期），要求不阻塞 UI，并补集成测试。
- AI 输出要点：生成器 options 结构化；强度评分返回分级与分数；安全报告使用 `QThread` + 独立 SQLite 连接；扫描结果用表格 Model/View 展示。
- 采纳：采纳了“Worker 线程 + 独立连接”的线程安全做法，并把扫描结果做成独立对话框。
- 最终修改：扫描逻辑与 UI 分层，并补齐数据库外键/索引与错误提示。

### 2.3 Phase3：CSV 互操作（导入导出）
- Prompt（节选）：支持浏览器导出的 CSV 导入导出；导入过程异步化，显示进度，并做去重策略。
- AI 输出要点：CSV 解析做 delimiter/引号处理；导入 Worker 事务化写入；对明文风险做提示；去重优先 url+username。
- 采纳：采纳了“导入异步 + 事务 + 风险提示 + 简单字段映射”的最小闭环方案。
- 最终修改：把数据库连接释放与线程清理做成稳定实现，并在测试中覆盖。

### 2.4 Phase4：网络能力（favicon + 泄露检查）
- Prompt（节选）：实现站点 favicon 拉取与缓存；安全报告加入可选的泄露检查（k-anonymity），并保持离线测试可跑。
- AI 输出要点：favicon 通过 `https://host/favicon.ico` 拉取，落地缓存表；泄露检查用哈希前缀查询，缓存响应，UI 给出“需要联网/不上传明文”提示。
- 采纳：采纳了“本地缓存 + TTL + 断网降级”的设计，并新增离线测试覆盖缓存路径。
- 最终修改：对 Qt6 API 差异与测试入口（需要 QGuiApplication）做了修正，详见 `docs/ai-mistakes.md` 与 `docs/debug-notes.md`。
